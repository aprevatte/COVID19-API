---
title: "README"
author: "Alex Prevatte"
date: "10/2/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Code to Create this Document
```{r,echo=TRUE,eval=FALSE}
rmarkdown::render("~/NCSU/ST558/Repos/ST558-Project1/README.Rmd", 
              output_format = "github_document", 
              output_dir = "~/NCSU/ST558/Repos/ST558-Project1",
              output_options = list(
                html_preview = FALSE
                )
              )

```

## Create vignette for reading and summarizing data from the API

NASA key: eR97TrIVKwTWcIIdWJKGyVFCSHjlZtuluykfI93U
Example to use the key: https://api.nasa.gov/planetary/apod?api_key=eR97TrIVKwTWcIIdWJKGyVFCSHjlZtuluykfI93U

# Required packages needed to run the code to create vignette

```{r}
library(httr)
library(jsonlite)
library(tidyverse)
library(RCurl)
```

Note: Maybe add death/total case ratio

```{r, confirmed}
confirmed <- function(country = "all"){
  ###
  # This function returns total covid case count, new covid case count,
  # and total death count for the country of interest.
  #
  ###
  
  # Obtain data from summary endpoint
  o <- fromJSON(
    "https://api.covid19api.com/summary"
    )
  
  output <- o$Countries
  
  if (country != "all"){
    
  # Filter rows based on selected Country. Select TotalConfirmed,
  # NewConfirmed, TotalDeaths
   if (country %in% output$Country){
    sub <- output %>%
       filter(Country == country) %>%
       select(Country,TotalConfirmed,NewConfirmed)
   }
  
  # Filter rows based on selected Country. Select TotalConfirmed,
  # NewConfirmed, TotalDeaths
  else if (country %in% output$CountryCode){
    sub <- output %>%
      filter(CountryCode == country) %>%
      select(Country,TotalConfirmed,NewConfirmed)
  }
  
  # Filter rows based on selected Country. Select TotalConfirmed,
  # NewConfirmed, TotalDeaths
  else if (country %in% output$Slug){
    sub <- output %>%
      filter(Slug == country) %>%
      select(Country,TotalConfirmed,NewConfirmed)
  }
  
  # Filter rows based on selected Country. Select TotalConfirmed,
  # NewConfirmed, TotalDeaths
  else {
    message <- paste("ERROR: Country was not found in Country,
                     CountryCode, or Slug columns. Check spelling.")
    stop(message)
  }
}
    # Return all confirmed cases from all countries
    else { 
      sub <- output %>%
       select(Country,TotalConfirmed,NewConfirmed)
    }
return(sub)
}
confirmed(country = "all")
```

```{r, deaths}
deaths <- function(country = "all"){
  ###
  # This function returns total covid case count, new covid case count,
  # and total death count for the country of interest.
  #
  ###
  
  # Obtain data from summary endpoint
  o <- fromJSON(
    "https://api.covid19api.com/summary"
    )
  
  output <- o$Countries
  
  if (country != "all"){
    
  # Filter rows based on selected Country. Select TotalConfirmed,
  # NewConfirmed, TotalDeaths
   if (country %in% output$Country){
    sub <- output %>%
       filter(Country == country) %>%
       select(Country,TotalDeaths,NewDeaths)
   }
  
  # Filter rows based on selected Country. Select TotalConfirmed,
  # NewConfirmed, TotalDeaths
  else if (country %in% output$CountryCode){
    sub <- output %>%
      filter(CountryCode == country) %>%
      select(Country,TotalDeaths,NewDeaths)
  }
  
  # Filter rows based on selected Country. Select TotalConfirmed,
  # NewConfirmed, TotalDeaths
  else if (country %in% output$Slug){
    sub <- output %>%
      filter(Slug == country) %>%
      select(Country,TotalDeaths,NewDeaths)
  }
  
  # Filter rows based on selected Country. Select TotalConfirmed,
  # NewConfirmed, TotalDeaths
  else {
    message <- paste("ERROR: Country was not found in Country,
                     CountryCode, or Slug columns. Check spelling.")
    stop(message)
  }
  }
  # Return all deaths from all countries
  else { 
       sub <- output %>%
       select(Country,TotalDeaths,NewDeaths)
    }
return(sub)
}

deaths(country = "all")
```
Will likely not use because recovered data is zero for everything 
```{r, recovered}
recovered <- function(country = "all"){
  ###
  # This function returns total covid case count, new covid case count,
  # and total death count for the country of interest.
  #
  ###
  
  # Obtain data from summary endpoint
  o <- fromJSON(
    "https://api.covid19api.com/summary"
    )
  
  output <- o$Countries
  
  if (country != "all"){
    
  # Filter rows based on selected Country. Select TotalConfirmed,
  # NewConfirmed, TotalDeaths
   if (country %in% output$Country){
    sub <- output %>%
       filter(Country == country) %>%
       select(Country,TotalRecovered,NewRecovered)
   }
  
  # Filter rows based on selected Country. Select TotalConfirmed,
  # NewConfirmed, TotalDeaths
  else if (country %in% output$CountryCode){
    sub <- output %>%
      filter(CountryCode == country) %>%
      select(Country,TotalRecovered,NewRecovered)
  }
  
  # Filter rows based on selected Country. Select TotalConfirmed,
  # NewConfirmed, TotalDeaths
  else if (country %in% output$Slug){
    sub <- output %>%
      filter(Slug == country) %>%
      select(Country,TotalRecovered,NewRecovered)
  }
  
  # Filter rows based on selected Country. Select TotalConfirmed,
  # NewConfirmed, TotalDeaths
  else {
    message <- paste("ERROR: Country was not found in Country,
                     CountryCode, or Slug columns. Check spelling.")
    stop(message)
  }
  }
  else { 
       sub <- output %>%
       select(Country,TotalRecovered,NewRecovered)
    }
return(sub)
}

recovered(country = "all")
```

Returns all cases by case type for a country from the first recorded case. 

```{r, daily}
daily <- function(country) {
  baseURL <- "https://api.covid19api.com/dayone/country/"
  value <- country
  last <- "?province=+"
  URL <- paste0(baseURL, value, last)
  out <- RCurl::getURL(URL)
  o <- fromJSON(URL)
  
  sub <- o %>%
       select(Country, Province, Confirmed, 
              Deaths, Recovered, Active, Date)
  
  return(sub)
}

daily("india")
```

Returns all live cases (10 minute increments) for the country and province of interest

```{r, live}
live <- function(country) {
  baseURL <- "https://api.covid19api.com/live/country/"
  value <- country
  region <- "?province=+"
  last <- "/status/confirmed"
  URL <- paste0(baseURL, value, region, last)
  out <- RCurl::getURL(URL)
  o <- fromJSON(out)
  
  sub <- o %>%
       select(Country, Province, Confirmed, 
              Date)
  
  return(sub)
}

live("brazil")
```


Total confirmed and total death percentages calculated from the summaries and world endpoints. Here we can directly see what percent of global cases and death are attributed to each country. 

```{r, worldPercent}
worldPercent <- function(country) {
  URL <- "https://api.covid19api.com/world/total"
  out <- RCurl::getURL(URL)
  o <- fromJSON(URL)
  
  death <- round((deaths(country)[1] / o[["TotalDeaths"]]) * 100, 2)
  confirm <- round((confirmed(country)[1] / o[["TotalConfirmed"]]) * 100,2)
  df <- data.frame(deaths(country)[1], o[["TotalDeaths"]], 
                   death, confirmed(country)[1],
                   o[["TotalConfirmed"]], confirm)
  colnames(df) <- c("Death Count", "Global Death Count", 
                    "% of Global Death", "Case count", 
                    "Global Case Count", "% of Global Case Count")
  return(df)
}

worldPercent("united-states")
```


# create contingency tables
# create numerical summaries for some quantitative variables at each setting of categorical.
# craete at least 5 plots - 1 bar, 1 histogram, 1 box, 1 scatter

Contingency Tables - Compare data for top 3 Countries based on confirmed Cases

```{r, contingency}
# Determine top 3 countries with highest total confirmed case count
totalConfirmed <- confirmed("all")[c(1,2)]
totalConfirmedOrdered <- totalConfirmed %>% arrange(TotalConfirmed)
totalConfirmedOrdered[190:192,]

#total confirmed cases from top 3 countries
usTotalConfirmed <- confirmed("united-states")[c(1,2)]
indiaTotalConfirmed <- confirmed("india")[c(1,2)]
brazilTotalConfirmed <- confirmed("brazil")[c(1,2)]
confirmedDF <- rbind(usTotalConfirmed, indiaTotalConfirmed, brazilTotalConfirmed)

#total deaths from top 3 countries
usTotalDeaths <- deaths("united-states")[2]
indiaTotalDeaths <- deaths("india")[2]
brazilTotalDeaths <- deaths("brazil")[2]
deathDF <- rbind(usTotalDeaths, indiaTotalDeaths, brazilTotalDeaths)

#combine confirmed and death dataframes and create table
combinedDF <- cbind(confirmedDF,deathDF)
colnames(combinedDF) <- c("Country", "Total Confirmed Cases", "Total Deaths")
knitr::kable(combinedDF)

#new confirmed cases from top 3 countries
usNewConfirmed <- confirmed("united-states")[c(1,3)]
indiaNewConfirmed <- confirmed("india")[c(1,3)]
brazilNewConfirmed <- confirmed("brazil")[c(1,3)]
confirmedNewDF <- rbind(usNewConfirmed, indiaNewConfirmed, brazilNewConfirmed)

#new deaths from top 3 countries
usNewConfirmed <- deaths("united-states")[3]
indiaNewConfirmed <- deaths("india")[3]
brazilNewConfirmed <- deaths("brazil")[3]
deathNewDF <- rbind(usNewConfirmed, indiaNewConfirmed, brazilNewConfirmed)

#combine confirmed and death dataframes and create table
combinedNewDF <- cbind(confirmedNewDF,deathNewDF)
colnames(combinedNewDF) <- c("Country", "New Daily Confirmed Cases", "New Daily Deaths")
knitr::kable(combinedNewDF)
```

Create numerical summaries for quant variables at each setting of categorical variable:

The daily function contains confirmed cases and death values that are cumulative sums for each subsequent day. To create quantitative summaries of this data, I decided to create two new variables that display the daily confirmed case and death count without summing these variables over time. This way, we can determine summary statistics for daily confirmed and death values. 

Notes: Numerical summaries of new confirmed and new death cases in United States 
```{r, numerical summaries}
#Create two new variables for United States
usDF <- daily("united-states")
n <- nrow(usDF)
newDailyConfirmed <- vector(n, mode = "numeric")
newDailyDeaths <- vector(n, mode = "numeric")
for (i in 1:n) {
  newDailyConfirmed[i] <- usDF$Confirmed[i+1] - usDF$Confirmed[i]
  newDailyDeaths[i] <- usDF$Deaths[i+1] - usDF$Deaths[i]
}

#Get summary statistics for new daily cases and deaths for the U.S
newDailyConfirmed <- data.frame(newDailyConfirmed)
newDailyConfirmed <- newDailyConfirmed %>%
summarize("Min." = min(newDailyConfirmed, na.rm = TRUE),
          "1st Quartile" = quantile(newDailyConfirmed, 0.25, na.rm = TRUE),
          "Median" = quantile(newDailyConfirmed, 0.5, na.rm = TRUE),
          "Mean" = mean(newDailyConfirmed, na.rm = TRUE),
          "3rd Quartile" = quantile(newDailyConfirmed, 0.75, na.rm = TRUE),
          "Max" = max(newDailyConfirmed, na.rm = TRUE),
          "Std. Dev." = sd(newDailyConfirmed, na.rm = TRUE)
          )
# assign category
newDailyConfirmed$Category <- "Daily Confirmed Cases"

newDailyDeaths <- data.frame(newDailyDeaths)
newDailyDeaths <- newDailyDeaths %>%
summarize("Min." = min(newDailyDeaths, na.rm = TRUE),
          "1st Quartile" = quantile(newDailyDeaths, 0.25, na.rm = TRUE),
          "Median" = quantile(newDailyDeaths, 0.5, na.rm = TRUE),
          "Mean" = mean(newDailyDeaths, na.rm = TRUE),
          "3rd Quartile" = quantile(newDailyDeaths, 0.75, na.rm = TRUE),
          "Max" = max(newDailyDeaths, na.rm = TRUE),
          "Std. Dev." = sd(newDailyDeaths, na.rm = TRUE)
          )
#assign category
newDailyDeaths$Category <- "Daily Death"

#Table of summary statistics
combinedStats <- rbind(newDailyConfirmed,newDailyDeaths)
combinedStats <- combinedStats %>% select(Category, Min., `1st Quartile`, Median,
                                          Mean, `3rd Quartile`, Max, `Std. Dev.`)
  
knitr::kable(combinedStats, 
             caption="Summary Statistics for Daily Confirmed Cases and Deaths in the United States",
             digits=0)
```

Boxplot of top three countries daily confirmed case count 

```{r, boxplot}
#Create daily confirmed variables for United States 
usDFCount <- daily("united-states")
n <- nrow(usDFCount)
usDailyConfirmed <- vector(n, mode = "numeric")
for (i in 1:n) {
  usDailyConfirmed[i] <- usDFCount$Confirmed[i+1] - usDFCount$Confirmed[i]
}

# assign category, column name, and convert to dataframe
usDailyConfirmed <- data.frame(usDailyConfirmed)
usDailyConfirmed$Country <- "United States"
colnames(usDailyConfirmed) <- c("Count", "Country")


#Create daily confirmed variables for India 
indiaDF <- daily("india")
n <- nrow(indiaDF)
n
indiaDailyConfirmed <- vector(n, mode = "numeric")
for (i in 1:n) {
  indiaDailyConfirmed[i] <- indiaDF$Confirmed[i+1] - indiaDF$Confirmed[i]
}


# assign category, column name, and convert to dataframe
indiaDailyConfirmed <- data.frame(indiaDailyConfirmed)
indiaDailyConfirmed$Country <- "India"
colnames(indiaDailyConfirmed) <- c("Count", "Country")


#Create daily confirmed variables for Brazil 
brazilDF <- daily("brazil")
n <- nrow(brazilDF)
brazilDailyConfirmed <- vector(n, mode = "numeric")
for (i in 1:n) {
  brazilDailyConfirmed[i] <- brazilDF$Confirmed[i+1] - brazilDF$Confirmed[i]
}

# assign category and convert to dataframe
brazilDailyConfirmed <- data.frame(brazilDailyConfirmed)
brazilDailyConfirmed$Country <- "Brazil"
colnames(brazilDailyConfirmed) <- c("Count", "Country")


combinedAll <- rbind(usDailyConfirmed,indiaDailyConfirmed,brazilDailyConfirmed)
combinedAll <- combinedAll %>% filter(!is.na(Count))

# Make a box plot of franchise win percentage by game type.
g <- ggplot(combinedAll, 
               aes(x = Country,
                   y = Count,
                   color = Country
        ))
  # Add the box plot layer.
  g + geom_boxplot() +
  # Add labels to the axes.
  scale_x_discrete("Daily Case Count") + 
  # Add a title.
  ggtitle("Daily Case Count for Top 3 Countries") + 
  # Remove the legend 
  theme(legend.position="none")
```

```{r, barplot}

```

